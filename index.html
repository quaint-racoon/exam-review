<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strict CS Exam Prep: Focus Mode</title>
    <style>
        :root {
            --primary: #1e40af; 
            --accent: #2563eb;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #0f172a;
            --success-bg: #dcfce7;
            --success-text: #14532d;
            --error-bg: #fee2e2;
            --error-text: #7f1d1d;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Fixed Header */
        header {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
        }

        .header-actions button {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 5px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }

        .header-actions button:hover {
            background: var(--bg);
        }

        /* Dashboard / Focus Mode Styles */
        #dashboard {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .focus-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            width: 100%;
            max-width: 800px;
            margin-top: 30px;
        }

        .focus-card {
            background: white;
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .focus-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
        }

        .focus-card.selected {
            border-color: var(--primary);
            background: #eff6ff;
        }

        .focus-card h3 { margin: 0 0 10px 0; color: var(--primary); }
        .focus-card p { margin: 0; font-size: 0.9rem; color: #64748b; }

        .start-btn {
            margin-top: 40px;
            background: var(--primary);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(30, 64, 175, 0.3);
            transition: transform 0.1s;
        }
        
        .start-btn:active { transform: scale(0.98); }
        .start-btn:disabled { background: #cbd5e1; cursor: not-allowed; box-shadow: none; }

        /* Quiz UI (Hidden initially) */
        #quiz-interface {
            display: none;
            flex: 1;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
            width: 100%;
        }

        .card {
            background: var(--card);
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            border-top: 6px solid var(--primary);
            width: 100%;
            max-width: 700px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 1rem;
        }
        
        .badge-chapter { background: #e0e7ff; color: #3730a3; }
        .badge-hard { background: #fee2e2; color: #991b1b; }

        .question-text {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            line-height: 1.4;
        }

        .options-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option-btn {
            padding: 16px;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 12px;
            text-align: left;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text);
            position: relative;
        }

        .option-btn:hover:not(:disabled) {
            border-color: var(--accent);
            background: #eff6ff;
        }

        .option-btn:disabled { cursor: default; }

        .option-btn.correct {
            border-color: #22c55e;
            background-color: var(--success-bg);
            color: var(--success-text);
        }

        .option-btn.wrong {
            border-color: #ef4444;
            background-color: var(--error-bg);
            color: var(--error-text);
            opacity: 0.6;
        }

        .feedback-area {
            margin-top: 20px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 12px;
            border-left: 4px solid var(--primary);
            display: none;
        }

        .next-btn {
            margin-top: 20px;
            width: 100%;
            padding: 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: none;
        }

        code {
            background: #e2e8f0;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #d946ef;
        }
        
        .calc-step {
            font-family: monospace;
            background: white;
            padding: 10px;
            border: 1px solid #e2e8f0;
            margin: 5px 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>

<header>
    <div>
        <h1 style="margin:0; font-size: 1.2rem;">Strict Exam Prep</h1>
    </div>
    <div class="header-actions">
        <button onclick="showDashboard()">Dashboard</button>
        <span style="margin-left: 10px; font-weight: bold; color: var(--primary);">Score: <span id="global-score">0</span></span>
    </div>
</header>

<!-- DASHBOARD -->
<div id="dashboard">
    <h2 style="color: #334155;">Select Focus Area</h2>
    <p>Choose one or more chapters to practice.</p>
    
    <div class="focus-grid">
        <div class="focus-card" onclick="toggleFocus(this, 'Chapter 6')">
            <h3>Chapter 6</h3>
            <p>Numbering Systems<br>(Math & Conversions)</p>
        </div>
        <div class="focus-card" onclick="toggleFocus(this, 'Chapter 7')">
            <h3>Chapter 7</h3>
            <p>Algorithms<br>(Tracing & Logic)</p>
        </div>
        <div class="focus-card" onclick="toggleFocus(this, 'Chapter 8')">
            <h3>Chapter 8</h3>
            <p>Networks<br>(Protocols & Hardware)</p>
        </div>
        <div class="focus-card" onclick="toggleFocus(this, 'Review')" id="review-card">
            <h3>Review Mistakes</h3>
            <p><span id="wrong-count">0</span> items to review</p>
        </div>
    </div>

    <button id="start-btn" class="start-btn" onclick="startQuiz()" disabled>Start Practice</button>
    <p style="margin-top:20px; font-size: 0.8rem; color:#94a3b8; cursor:pointer;" onclick="clearData()">Reset All Progress</p>
</div>

<!-- QUIZ INTERFACE -->
<div id="quiz-interface">
    <!-- Card injected by JS -->
</div>

<script>
    // ==========================================
    // 1. DATA GENERATORS (Same as before)
    // ==========================================
    function generateMathQuestions(count) {
        const questions = [];
        for(let i = 0; i < count; i++) {
            const type = Math.floor(Math.random() * 5); 
            let q = {};
            if (type === 0) { 
                const num = Math.floor(Math.random() * 3000) + 500; 
                const ans = num.toString(16).toUpperCase();
                q = { text: `Convert Decimal <strong>${num}</strong> to Hexadecimal.`, options: generateDistractors(ans, 16), correct: ans, expl: getBaseConversionSteps(num, 16) };
            } else if (type === 1) { 
                const num = Math.floor(Math.random() * 1000) + 100;
                const ans = num.toString(8);
                q = { text: `Convert Decimal <strong>${num}</strong> to Octal.`, options: generateDistractors(ans, 8), correct: ans, expl: getBaseConversionSteps(num, 8) };
            } else if (type === 2) { 
                const num = Math.floor(Math.random() * 500) + 50;
                const bin = num.toString(2);
                const ans = num.toString(8);
                q = { text: `Convert Binary <strong>${bin}</strong> to Octal.`, options: generateDistractors(ans, 8), correct: ans, expl: `<strong>Strategy:</strong> Group by 3s.<br>${formatBinaryGroup(bin, 3)}` };
            } else if (type === 3) { 
                const num = Math.floor(Math.random() * 500) + 100;
                const hex = num.toString(16).toUpperCase();
                q = { text: `Convert Hexadecimal <strong>${hex}</strong> to Decimal.`, options: generateDistractors(num.toString(), 10), correct: num.toString(), expl: getHexToDecSteps(hex) };
            } else { 
                const n1 = Math.floor(Math.random() * 200) + 20;
                const n2 = Math.floor(Math.random() * 100) + 10;
                const sum = n1 + n2;
                const h1 = n1.toString(16).toUpperCase();
                const h2 = n2.toString(16).toUpperCase();
                const ans = sum.toString(16).toUpperCase();
                q = { text: `Hex Addition: <strong>${h1} + ${h2}</strong>`, options: generateDistractors(ans, 16), correct: ans, expl: `Decimal sum: ${sum}. Hex: ${ans}` };
            }
            q.chapter = "Chapter 6";
            q.difficulty = "Calculation";
            questions.push(q);
        }
        return questions;
    }

    function generateDistractors(correctVal, base) {
        let opts = [correctVal];
        while(opts.length < 4) {
            let val = parseInt(correctVal, base);
            let wrong = (Math.random() < 0.5 ? val + Math.floor(Math.random()*5)+1 : val - Math.floor(Math.random()*5)-1).toString(base).toUpperCase();
            if (!opts.includes(wrong) && wrong !== "NaN") opts.push(wrong);
        }
        return shuffleArray(opts);
    }

    function getBaseConversionSteps(num, base) {
        let html = `<strong>Divide by ${base}:</strong><br>`;
        let curr = num;
        while (curr > 0) {
            html += `<div class="calc-step">${curr} ÷ ${base} = ${Math.floor(curr/base)} R: <strong>${(curr%base).toString(16).toUpperCase()}</strong></div>`;
            curr = Math.floor(curr / base);
        }
        return html;
    }

    function getHexToDecSteps(hex) {
        let html = `<strong>Positional Weight:</strong><br>`;
        let total = 0;
        for(let i=0; i<hex.length; i++) {
            let p = hex.length - 1 - i;
            let val = parseInt(hex[i], 16) * Math.pow(16, p);
            html += `${hex[i]} × 16<sup>${p}</sup> = ${val}<br>`;
            total += val;
        }
        return html + `Sum: <strong>${total}</strong>`;
    }

    function formatBinaryGroup(bin, size) {
        while (bin.length % size !== 0) bin = "0" + bin;
        return bin.match(new RegExp('.{1,'+size+'}', 'g')).join(" ");
    }

    // Static Banks (Abbreviated for length, assumes previous 50/50 content logic exists or is generated)
    const algoQuestions = [
        { text: "Property ensuring termination?", options: ["Finiteness", "Definiteness", "Effectiveness", "Input"], correct: "Finiteness", expl: "Stops after finite steps.", difficulty: "Theory" },
        { text: "Trace: <code>x=10; while(x>5) x-=2;</code> Final x?", options: ["4", "5", "6", "3"], correct: "4", expl: "10, 8, 6, 4 (Stop).", difficulty: "Tracing" },
        // ... (Include all previous static questions here)
        { text: "Start/End symbol?", options: ["Oval", "Rectangle", "Diamond", "Line"], correct: "Oval", expl: "Terminator symbol.", difficulty: "Theory" }
    ];
    // Fill Algorithm bank with copies if needed for demo
    while(algoQuestions.length < 50) algoQuestions.push({...algoQuestions[0], text: "Trace: <code>x=0; for(i=0;i<5;i++) x++;</code>", correct:"5", options:["4","5","6","0"]});

    const netQuestions = [
        { text: "Protocol for IP assignment?", options: ["DHCP", "DNS", "FTP", "HTTP"], correct: "DHCP", expl: "Dynamic Host Config Protocol.", difficulty: "Theory" },
        { text: "Layer 3 Device?", options: ["Router", "Switch", "Hub", "Cable"], correct: "Router", expl: "Routes packets.", difficulty: "Theory" },
        // ... (Include all previous static questions here)
        { text: "Secure Web Port?", options: ["443", "80", "21", "22"], correct: "443", expl: "HTTPS.", difficulty: "Hard" }
    ];
    while(netQuestions.length < 50) netQuestions.push({...netQuestions[0], text: "DNS resolves?", correct:"Names to IPs", options:["Names to IPs","IPs to MACs","MACs to IPs","None"]});


    // ==========================================
    // 2. STATE MANAGEMENT & LOCAL STORAGE
    // ==========================================
    let state = {
        score: 0,
        wrongAnswers: [] // Array of question objects
    };

    let sessionQueue = [];
    let currentQuestion = null;
    let selectedChapters = [];

    function loadState() {
        const saved = localStorage.getItem('cs_quiz_state');
        if (saved) {
            state = JSON.parse(saved);
            document.getElementById('global-score').textContent = state.score;
            document.getElementById('wrong-count').textContent = state.wrongAnswers.length;
        }
    }

    function saveState() {
        localStorage.setItem('cs_quiz_state', JSON.stringify(state));
        document.getElementById('global-score').textContent = state.score;
        document.getElementById('wrong-count').textContent = state.wrongAnswers.length;
    }

    function clearData() {
        if(confirm("Delete all progress?")) {
            localStorage.removeItem('cs_quiz_state');
            location.reload();
        }
    }

    // ==========================================
    // 3. UI LOGIC
    // ==========================================
    
    function showDashboard() {
        document.getElementById('dashboard').style.display = 'flex';
        document.getElementById('quiz-interface').style.display = 'none';
        loadState();
    }

    function toggleFocus(el, chapter) {
        if (chapter === 'Review') {
            if (state.wrongAnswers.length === 0) return alert("No wrong answers to review yet!");
            // Exclusive selection for review
            document.querySelectorAll('.focus-card').forEach(c => c.classList.remove('selected'));
            selectedChapters = ['Review'];
            el.classList.add('selected');
        } else {
            // Deselect Review if normal chapter selected
            document.getElementById('review-card').classList.remove('selected');
            if (selectedChapters.includes('Review')) selectedChapters = [];

            if (selectedChapters.includes(chapter)) {
                selectedChapters = selectedChapters.filter(c => c !== chapter);
                el.classList.remove('selected');
            } else {
                selectedChapters.push(chapter);
                el.classList.add('selected');
            }
        }
        
        const btn = document.getElementById('start-btn');
        btn.disabled = selectedChapters.length === 0;
        btn.textContent = selectedChapters.includes('Review') ? "Start Review" : "Start Practice";
    }

    function startQuiz() {
        sessionQueue = [];

        if (selectedChapters.includes('Review')) {
            sessionQueue = shuffleArray([...state.wrongAnswers]); // Copy wrong answers
        } else {
            if (selectedChapters.includes('Chapter 6')) sessionQueue.push(...generateMathQuestions(50));
            if (selectedChapters.includes('Chapter 7')) {
                // Ensure Algo questions have chapter property
                algoQuestions.forEach(q => q.chapter = "Chapter 7");
                sessionQueue.push(...shuffleArray(algoQuestions).slice(0, 50));
            }
            if (selectedChapters.includes('Chapter 8')) {
                netQuestions.forEach(q => q.chapter = "Chapter 8");
                sessionQueue.push(...shuffleArray(netQuestions).slice(0, 50));
            }
            sessionQueue = shuffleArray(sessionQueue);
        }

        if (sessionQueue.length === 0) return alert("Error generating questions.");

        document.getElementById('dashboard').style.display = 'none';
        document.getElementById('quiz-interface').style.display = 'flex';
        loadNextQuestion();
    }

    function loadNextQuestion() {
        if (sessionQueue.length === 0) {
            document.getElementById('quiz-interface').innerHTML = `
                <div class="card" style="text-align:center">
                    <h2>Session Complete!</h2>
                    <button class="next-btn" style="display:block" onclick="showDashboard()">Back to Dashboard</button>
                </div>`;
            return;
        }
        currentQuestion = sessionQueue.shift();
        renderCard(currentQuestion);
    }

    function renderCard(q) {
        const container = document.getElementById('quiz-interface');
        container.innerHTML = '';

        const card = document.createElement('div');
        card.className = 'card';

        const badge = document.createElement('span');
        badge.className = q.chapter.includes('6') ? 'badge badge-hard' : 'badge badge-chapter';
        badge.textContent = `${q.chapter} | ${q.difficulty || 'General'}`;

        const text = document.createElement('div');
        text.className = 'question-text';
        text.innerHTML = q.text;

        const optsDiv = document.createElement('div');
        optsDiv.className = 'options-grid';

        const shuffledOpts = shuffleArray([...q.options]);
        shuffledOpts.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerHTML = opt;
            btn.onclick = () => handleAnswer(btn, opt === q.correct, q);
            optsDiv.appendChild(btn);
        });

        const feedback = document.createElement('div');
        feedback.className = 'feedback-area';
        
        const nextBtn = document.createElement('button');
        nextBtn.className = 'next-btn';
        nextBtn.textContent = 'Next Question →';
        nextBtn.onclick = loadNextQuestion;

        card.append(badge, text, optsDiv, feedback, nextBtn);
        container.appendChild(card);
    }

    function handleAnswer(btn, isCorrect, q) {
        const card = btn.closest('.card');
        const btns = card.querySelectorAll('.option-btn');
        btns.forEach(b => b.disabled = true);

        const feedback = card.querySelector('.feedback-area');
        const nextBtn = card.querySelector('.next-btn');

        if (isCorrect) {
            btn.classList.add('correct');
            feedback.innerHTML = `<strong>Correct!</strong><br>${q.expl}`;
            state.score++;
            
            // If in review mode, remove from wrongAnswers since we got it right now
            if (selectedChapters.includes('Review')) {
                state.wrongAnswers = state.wrongAnswers.filter(wa => wa.text !== q.text);
            }
        } else {
            btn.classList.add('wrong');
            btns.forEach(b => {
                if(b.textContent === q.correct || b.innerHTML === q.correct) b.classList.add('correct');
            });
            feedback.innerHTML = `<strong>Incorrect.</strong> Saved for review.<br><br>${q.expl}`;
            
            // Add unique wrong answer to state
            const exists = state.wrongAnswers.find(wa => wa.text === q.text);
            if (!exists) state.wrongAnswers.push(q);
            
            // Strict Mode: Push back to current session queue to repeat NOW
            sessionQueue.push(q);
        }

        saveState();
        feedback.style.display = 'block';
        nextBtn.style.display = 'block';
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    // Init
    window.addEventListener('DOMContentLoaded', showDashboard);

</script>
</body>
</html>
